{% extends 'userpanel/user_base.html' %}
{% load static %}
{% block title %}
    Blog | ViewBlog
{% endblock %}
{% block content %}


<div class="container-xxl flex-grow-1 container-p-y" style="margin-top: 40px;">
  <div class="card mb-4">
    <!-- Edit Button (only visible to the author) -->
    {% if user.is_authenticated and user == blog.author %}
      <div class="card-header d-flex justify-content-end">
        <a href="{% url 'edit_blog' blog.id %}" class="btn btn-primary btn-sm">Edit</a>
      </div>
    {% endif %}
    
    <div class="text-center mx-auto mb-5" data-wow-delay="0.1s" style="max-width: 500px;">
        <p class="text-primary text-uppercase mb-2" style="font-size: 1.2rem; font-weight: bold; color: #ff5722; text-shadow: 2px 2px 4px rgba(0,0,0,0.5);"></p>
        <h1 class="display-6 mb-4" style="font-size: 3rem; font-weight: bold; color: #473757; text-shadow: 3px 3px 6px rgba(0,0,0,0.4);">
            {{ blog.title }}
        </h1>
        <p>Written by <strong>{{ blog.author }}</strong> </p>
    </div>
    
    <div class="card-body">
        <!-- Blog Image -->
        {% if blog.blog_image %}
            <img class="large-img mb-4" src="{{ blog.blog_image.url }}" alt="Blog image" />
        {% else %}
            <img class="large-img mb-4" src="{% static 'assets/img/elements/2.jpg' %}" alt="Default image" />
        {% endif %}

        <!-- Blog Details -->
        <div class="blog-details mb-4">
            
            <p><strong>Published on:</strong> {{ blog.created_at|date:"F j, Y, g:i A" }}</p>
        </div>

        <!-- Blog Description -->
        <div class="blog-description">
            {{ blog.description|linebreaksbr|safe }}
        </div>
    </div>
  </div>
</div>

<style>
  .large-img {
      width: 100%;
      height: auto;
      object-fit: cover;
      display: block;
      margin: 0 auto;
  }

  .blog-description {
      white-space: pre-wrap; /* Preserve whitespace and line breaks */
      font-size: 1em;
      line-height: 1.6;
      color: #333;
  }

  .card-header {
      font-size: 1.5em;
      font-weight: bold;
  }

  .blog-details p {
        margin: 0; /* Remove default margins for consistency */
        font-size: 1em;
    }

  .btn-primary {
      background-color: #9136ce !important;
      border-color: #9136ce !important;
  }

  .btn-sm {
      font-size: 0.875rem;
      padding: 0.25rem 0.5rem;
      line-height: 1.5;
      border-radius: 0.2rem;
  }
</style>

    <!-- Comment Section -->
    <div class="card mb-5">
        <div class="card-body">
            <h5 class="card-title">Comments ({{ count }})</h5>
            
            <!-- List of Comments -->
            <ul class="list-group">
                {% for comment in comments %}
                <li class="list-group-item d-flex align-items-center">
                    {% if comment.author.profile.profile_image %}
                        <img src="{{ comment.author.profile.profile_image.url }}" alt="Profile Image" class="profile-image-small me-2">
                    {% else %}
                        <img src="{% static 'default_image.jpg' %}" alt="Default Profile Image" class="profile-image-small me-2">
                    {% endif %}
                    <div>
                        <p>{{ comment.comment }}</p>
                        <small class="text-muted">By {{ comment.author.username }}, {{ comment.created_at }}</small>
                    </div>
    
                    <!-- Edit and Delete Buttons -->
                    {% if comment.author == user %}
                    <div class="ms-auto">
                        <!-- Edit Comment Form -->
                        <form method="GET" action="{% url 'view_blog' blog.id %}" class="d-inline">
                            <input type="hidden" name="edit_comment_id" value="{{ comment.id }}">
                            <button type="submit" class="btn btn-sm btn-outline-primary">Edit</button>
                        </form>
    
                        <!-- Delete Comment Form -->
                        <form method="POST" action="{% url 'view_blog' blog.id %}" class="d-inline">
                            {% csrf_token %}
                            <input type="hidden" name="delete_comment_id" value="{{ comment.id }}">
                            <button type="submit" class="btn btn-sm btn-outline-danger">Delete</button>
                        </form>
                    </div>
                    {% endif %}
                </li>
                {% empty %}
                <li class="list-group-item">No comments yet.</li>
                {% endfor %}
            </ul>
            
            <!-- Comment Form -->
            <form id="commentForm" action="{% url 'view_blog' blog.id %}" method="POST">
                {% csrf_token %}
                {% if comment_to_edit %}
                    <input type="hidden" name="edit_comment_id" value="{{ comment_to_edit.id }}">
                    <label for="commentContent" class="form-label"></label>
                {% else %}
                    <label for="commentContent" class="form-label"></label>
                {% endif %}
                {{ form.comment|safe }}
                <button type="submit" class="btn btn-info mt-2">
                    {% if comment_to_edit %} Update Comment {% else %} Post Comment {% endif %}
                </button>
            </form>
            
            
            
            
        </div>
    </div>
    
    
    
    
    
    
    <!-- /Comment Section -->
</div>
<style>
    .profile-image-small {
        width: 40px; 
        height: 40px; 
        border-radius: 50%;
        object-fit: cover;
        margin-right: 10px; 
    }
    .comment-textarea {
    height: 100px;  /* Adjust the height as needed */
    resize: vertical;  /* Allow vertical resizing only */
    width: 100%;  /* Full width */
}

</style>

{% endblock %}